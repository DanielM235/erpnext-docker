# ERPNext Docker Production Environment Configuration
# =================================================================
# IMPORTANT: This is a template file. Copy this to .env and 
# update all values with your production settings.
# 
# Command: cp .env.example .env
# Then edit: nano .env
# 
# Based on ERPNext v16.0.1 (released January 2026)
# Optimized for production deployment with host-level Nginx reverse proxy
# Reference: https://github.com/frappe/frappe_docker
# =================================================================

# =================================================================
# PROJECT CONFIGURATION - REQUIRED
# =================================================================
# Docker Compose project name - used as prefix for containers and networks
# Use lowercase letters, numbers, and hyphens only
COMPOSE_PROJECT_NAME=erpnext-prod

# Data storage path - where all persistent data will be stored
# Ensure this directory exists and has proper permissions (see SETUP.md)
DATA_PATH=./data

# Timezone for all services (affects logs, scheduled tasks, etc.)
# Use standard timezone identifiers (e.g., UTC, America/New_York, Europe/London)
TIMEZONE=UTC

# =================================================================
# ERPNEXT APPLICATION CONFIGURATION - REQUIRED
# =================================================================
# ERPNext version - use specific version for production stability
# v16.0.1 is the latest stable release as of January 2026
# Check https://hub.docker.com/r/frappe/erpnext/tags for available versions
#
# Available version formats:
# - Exact version: 16.0.1 (recommended for production)
# - Major branch: v16 (tracks latest v16.x.x)
# - Latest: latest (not recommended for production)
ERPNEXT_VERSION=16.0.1

# Image pull policy
# always: Always pull latest image (good for version tracking branches)
# if-not-present: Use local cache if available
# never: Only use local images
PULL_POLICY=always

# Restart policy for services
# unless-stopped: Restart unless explicitly stopped (recommended)
# on-failure: Restart only on non-zero exit
# always: Always restart
RESTART_POLICY=unless-stopped

# Primary domain name for your ERPNext installation
# This must match your DNS configuration and SSL certificate
# Example: erp.yourcompany.com
# CRITICAL: This will be used to create the ERPNext site
SITE_NAME=your-domain.com

# ERPNext administrator password (minimum 8 characters)
# This will be the password for the Administrator user
# Use a strong password with mixed case, numbers, and symbols
ADMIN_PASSWORD=your_admin_password_change_this

# Site name header configuration
# Default: $$host (resolves site by HTTP Host header)
# Set to specific site name if you want to override host-based resolution
# Useful for development or when accessing by IP address
FRAPPE_SITE_NAME_HEADER=$$host

# =================================================================
# DATABASE CONFIGURATION - REQUIRED
# =================================================================
# MariaDB version - use version officially tested with ERPNext v16
# 10.6 is the LTS version recommended by Frappe for v16
# Note: MariaDB 10.11 also works but 10.6 is more widely tested
DB_VERSION=10.6

# MariaDB root password - use a very strong password
# This is the master password for database administration
# Generate with: openssl rand -base64 32
DB_ROOT_PASSWORD=your_very_secure_root_password_change_this

# Database host and port
# Default: 'db' (matches the database service name)
# Only change if using external database
DB_HOST=db
DB_PORT=3306

# =================================================================
# DATABASE PERFORMANCE TUNING - OPTIONAL
# =================================================================
# MariaDB InnoDB buffer pool size - critical for performance
# Set to 50-70% of available RAM for dedicated database
# For shared servers, set to 25-40% of total RAM
# Examples: 512M, 1G, 2G, 4G
DB_INNODB_BUFFER_POOL_SIZE=2G

# InnoDB log file size - affects write performance
# Larger values improve write performance but increase recovery time
# Recommended: 256M to 1G for production systems
DB_INNODB_LOG_FILE_SIZE=256M

# Maximum database connections
# Increase for high-traffic sites (each connection uses ~2-3MB RAM)
DB_MAX_CONNECTIONS=200

# =================================================================
# REDIS CONFIGURATION - OPTIONAL
# =================================================================
# Redis version - stable version with security updates
# Version 7 Alpine provides good performance with small footprint
REDIS_VERSION=7-alpine

# Redis cache memory limit - for session and object caching
# Should handle your concurrent user sessions
# Rule of thumb: 1MB per active user + overhead
REDIS_CACHE_MAXMEMORY=512mb

# Redis queue memory limit - for background jobs
# Usually smaller than cache as jobs are processed quickly
REDIS_QUEUE_MAXMEMORY=256mb

# =================================================================
# NGINX FRONTEND CONFIGURATION - OPTIONAL
# =================================================================
# Frontend port for host reverse proxy connection
# Your host Nginx should proxy to this port
# Change if port 8080 conflicts with existing applications
FRONTEND_PORT=8080

# Upstream real IP configuration (for proper client IP logging)
# Set to your reverse proxy's IP address
UPSTREAM_REAL_IP_ADDRESS=127.0.0.1

# Header containing the real client IP
UPSTREAM_REAL_IP_HEADER=X-Forwarded-For

# Whether to recursively search for real IP
# off: Use first trusted IP from header
# on: Search through proxy chain for real IP
UPSTREAM_REAL_IP_RECURSIVE=off

# Proxy read timeout in seconds
# Increase for complex reports or large data operations
PROXY_READ_TIMEOUT=120

# Maximum file upload size
# Increase if you need to upload large files
# Format: 50m (megabytes), 1g (gigabyte)
CLIENT_MAX_BODY_SIZE=50m

# =================================================================
# CONTAINER RESOURCE LIMITS - RECOMMENDED
# =================================================================
# Adjust based on your server specifications and expected load
# These limits prevent any single service from consuming all resources

# ERPNext Backend Resource Limits
BACKEND_CPU_LIMIT=2.0
BACKEND_MEMORY_LIMIT=4G
BACKEND_CPU_RESERVE=0.5
BACKEND_MEMORY_RESERVE=1G

# ERPNext Frontend Resource Limits (Nginx - lighter workload)
FRONTEND_CPU_LIMIT=1.0
FRONTEND_MEMORY_LIMIT=1G

# WebSocket Server Resource Limits
WEBSOCKET_CPU_LIMIT=0.5
WEBSOCKET_MEMORY_LIMIT=512M

# Queue Worker Resource Limits
QUEUE_CPU_LIMIT=1.0
QUEUE_MEMORY_LIMIT=2G

# Scheduler Resource Limits
SCHEDULER_CPU_LIMIT=0.5
SCHEDULER_MEMORY_LIMIT=1G

# Database Resource Limits
DB_CPU_LIMIT=2.0
DB_MEMORY_LIMIT=4G
DB_CPU_RESERVE=0.5
DB_MEMORY_RESERVE=512M

# Redis Resource Limits
REDIS_CPU_LIMIT=1.0
REDIS_CACHE_MEMORY_LIMIT=1G
REDIS_QUEUE_MEMORY_LIMIT=512M

# =================================================================
# SECURITY CONFIGURATION - RECOMMENDED
# =================================================================
# Development mode - NEVER enable in production
# Enables debug features and detailed error messages
# WARNING: Exposes sensitive information
DEVELOPER_MODE=0

# =================================================================
# LOGGING CONFIGURATION - RECOMMENDED
# =================================================================
# Docker log rotation settings
# Maximum size before log rotation
LOG_MAX_SIZE=10m

# Number of rotated log files to keep
LOG_MAX_FILES=5

# =================================================================
# OPTIONAL: DOCKER SECRETS SUPPORT
# =================================================================
# Use Docker secrets for database password instead of environment variable
# Path to the file containing the database password
# DB_PASSWORD_SECRETS_FILE=/run/secrets/db_password

# =================================================================
# OPTIONAL: EXTERNAL SERVICES
# =================================================================
# Use these if you have external Redis or Database servers

# External Redis (uncomment and configure if using external Redis)
# REDIS_CACHE=external-redis:6379
# REDIS_QUEUE=external-redis:6380

# External Database (uncomment and configure if using external DB)
# DB_HOST=external-db.example.com
# DB_PORT=3306

# =================================================================
# OPTIONAL: SSL/HTTPS (Only if using Traefik, not needed for host Nginx)
# =================================================================
# Let's Encrypt email for certificate notifications
# LETSENCRYPT_EMAIL=admin@example.com

# Sites for SSL certificates (Traefik format)
# SITES=`erp.example.com`

# =================================================================
# USAGE INSTRUCTIONS
# =================================================================
# 1. Copy this file: cp .env.example .env
# 2. Edit the .env file with your actual values:
#    - Set SITE_NAME to your domain
#    - Set ADMIN_PASSWORD to a strong password
#    - Set DB_ROOT_PASSWORD to a strong password
# 3. Create data directories:
#    mkdir -p data/{sites,logs,db,redis_queue}
#    sudo chown -R 1000:1000 data/
# 4. Start services: docker compose up -d
# 5. Monitor startup: docker compose logs -f create-site
# 6. Access your site: http://localhost:8080
#
# For production with SSL:
# - Configure host Nginx with SSL (see SETUP.md)
# - Point DNS to your server
# - Update SITE_NAME to match your domain
# =================================================================

# =================================================================
# UPGRADING FROM v15
# =================================================================
# 1. Backup your data:
#    docker compose exec backend bench --site <site> backup --with-files
# 2. Stop services: docker compose down
# 3. Update ERPNEXT_VERSION in this file
# 4. Start services: docker compose up -d
# 5. Run migrations:
#    docker compose exec backend bench --site <site> migrate
# 6. Clear cache:
#    docker compose exec backend bench --site <site> clear-cache
# =================================================================
