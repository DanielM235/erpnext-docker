# ERPNext Docker Production Environment Configuration
# =================================================================
# IMPORTANT: This is a template file. Copy this to .env and 
# update all values with your production settings.
# 
# Command: cp .env.example .env
# Then edit: nano .env
# 
# Based on ERPNext v15.83.0 (latest stable as of October 2025)
# Optimized for production deployment with host-level Nginx reverse proxy
# =================================================================

# =================================================================
# PROJECT CONFIGURATION - REQUIRED
# =================================================================
# Docker Compose project name - used as prefix for containers and networks
# Use lowercase letters, numbers, and hyphens only
# This helps organize multiple ERPNext deployments on same server
COMPOSE_PROJECT_NAME=erpnext-prod

# Data storage path - where all persistent data will be stored
# Ensure this directory exists and has proper permissions (1000:1000)
# This path will contain: sites/, logs/, db/, redis_queue/
DATA_PATH=./data

# Timezone for all services (affects logs, scheduled tasks, etc.)
# Use standard timezone identifiers (e.g., UTC, America/New_York, Europe/London)
TIMEZONE=UTC

# =================================================================
# ERPNEXT APPLICATION CONFIGURATION - REQUIRED
# =================================================================
# ERPNext version - use specific version for production stability
# Latest stable: v15.83.0 (updated October 15, 2025)
# Check https://hub.docker.com/r/frappe/erpnext/tags for newer versions
ERPNEXT_VERSION=15.83.0

# Primary domain name for your ERPNext installation
# This must match your DNS configuration and SSL certificate
# Example: erp.yourcompany.com, erpnext.example.org
# CRITICAL: This will be used to create the ERPNext site
SITE_NAME=your-domain.com

# ERPNext administrator password
# This will be the password for the Administrator user
# Minimum 12 characters, use strong password with mixed case, numbers, symbols
ADMIN_PASSWORD=your_admin_password_min_12_chars_change_this

# =================================================================
# DATABASE CONFIGURATION - REQUIRED
# =================================================================
# MariaDB version - use LTS version for stability
# 10.11 is the current LTS with long-term support until 2028
DB_VERSION=10.11

# MariaDB root password - use a very strong password
# This is the master password for database administration
# Minimum 20 characters with mixed case, numbers, and symbols
DB_ROOT_PASSWORD=your_very_secure_root_password_here_min_20_chars_change_this

# Application database password - different from root password
# This is used by ERPNext to connect to the database
# Should be different from root password for security
DB_PASSWORD=your_secure_app_database_password_here_change_this

# Database name for ERPNext
# Convention: use descriptive name (e.g., erpnext_production, erp_company)
DB_NAME=erpnext_production

# Database user for ERPNext application
# This user will have full access to the ERPNext database only
DB_USER=erpnext_user

# Database host - use service name from docker-compose.yml
# Default: 'db' (matches the database service name)
# Only change if you're using external database
DB_HOST=db

# Database port - standard MySQL/MariaDB port
# Keep default unless you have specific networking requirements
DB_PORT=3306

# =================================================================
# DATABASE PERFORMANCE TUNING - OPTIONAL
# =================================================================
# MariaDB InnoDB buffer pool size - critical for performance
# Set to 70-80% of dedicated database server RAM
# For shared servers, set to 25-50% of total RAM
# Examples: 1G, 2G, 4G, 8G
DB_INNODB_BUFFER_POOL_SIZE=2G

# InnoDB log file size - affects write performance
# Larger values improve write performance but increase recovery time
# Recommended: 256M to 1G for production systems
DB_INNODB_LOG_FILE_SIZE=256M

# Maximum database connections
# Increase for high-traffic sites, decrease for resource-constrained servers
# Each connection uses memory, balance with available RAM
DB_MAX_CONNECTIONS=200

# Query cache size - improves read performance for repeated queries
# Set to 0 to disable, or 64M-256M for moderate traffic
# Note: Query cache is deprecated in newer MySQL versions
DB_QUERY_CACHE_SIZE=64M

# =================================================================
# REDIS CONFIGURATION - OPTIONAL
# =================================================================
# Redis version - use stable version with security updates
# Version 7 includes performance improvements and security fixes
REDIS_VERSION=7-alpine

# Redis cache memory limit - for session and object caching
# Should be sufficient for your concurrent user count
# Examples: 256mb, 512mb, 1gb, 2gb
REDIS_CACHE_MAXMEMORY=512mb

# Redis queue memory limit - for background jobs
# Usually smaller than cache, jobs are processed quickly
# Examples: 128mb, 256mb, 512mb
REDIS_QUEUE_MAXMEMORY=256mb

# =================================================================
# APPLICATION PERFORMANCE TUNING - OPTIONAL
# =================================================================
# ERPNext backend worker processes
# Recommended: Number of CPU cores available to container
# More workers = better concurrent request handling
BACKEND_WORKERS=4

# Gunicorn worker class - affects performance characteristics
# sync: Simple, stable, good for most workloads
# gevent: Async, better for I/O-heavy workloads
# tornado: WebSocket support (if needed)
WORKER_CLASS=sync

# Request timeout in seconds
# Increase for complex reports or large data operations
# Default 300 (5 minutes) should be sufficient for most operations
BACKEND_TIMEOUT=300

# Maximum file upload size
# Increase if you need to upload large files (documents, images, etc.)
# Format: 50m (50 megabytes), 1g (1 gigabyte)
MAX_UPLOAD_SIZE=50m

# Proxy timeout for frontend nginx
# Should match or exceed BACKEND_TIMEOUT
PROXY_TIMEOUT=300

# =================================================================
# CONTAINER RESOURCE LIMITS - RECOMMENDED
# =================================================================
# ERPNext Backend Resource Limits
# Adjust based on your server capacity and expected load
BACKEND_CPU_LIMIT=2.0              # Number of CPU cores
BACKEND_MEMORY_LIMIT=4G            # Maximum memory usage
BACKEND_CPU_RESERVE=0.5            # Reserved CPU cores
BACKEND_MEMORY_RESERVE=1G          # Reserved memory

# ERPNext Frontend Resource Limits
# Frontend is lighter as it only serves static files and proxies requests
FRONTEND_CPU_LIMIT=1.0
FRONTEND_MEMORY_LIMIT=1G
FRONTEND_CPU_RESERVE=0.25
FRONTEND_MEMORY_RESERVE=256M

# WebSocket Server Resource Limits
# WebSocket handles real-time communications
WEBSOCKET_CPU_LIMIT=0.5
WEBSOCKET_MEMORY_LIMIT=512M

# Database Resource Limits
# Database typically needs significant resources for good performance
DB_CPU_LIMIT=2.0
DB_MEMORY_LIMIT=4G
DB_CPU_RESERVE=0.5
DB_MEMORY_RESERVE=1G

# Redis Resource Limits
# Separate limits for cache and queue Redis instances
REDIS_CPU_LIMIT=1.0
REDIS_CACHE_MEMORY_LIMIT=1G
REDIS_QUEUE_MEMORY_LIMIT=512M

# =================================================================
# NETWORK CONFIGURATION - ADVANCED
# =================================================================
# Frontend port for host reverse proxy connection
# Change this if port 8080 conflicts with existing applications
# Your host Nginx should proxy to this port
FRONTEND_PORT=8080

# Docker network subnets - change if conflicts with existing networks
# Frontend network: Connects to host reverse proxy
FRONTEND_SUBNET=172.20.0.0/24

# Backend network: Internal service communication only
BACKEND_SUBNET=172.21.0.0/24

# =================================================================
# SECURITY CONFIGURATION - RECOMMENDED
# =================================================================
# Development mode - NEVER enable in production
# Enables debug features and detailed error messages
# WARNING: Exposes sensitive information, only use in development
DEVELOPER_MODE=0

# Enable detailed logging for troubleshooting
# Set to 1 only when debugging issues, impacts performance
DEBUG_LOGGING=0

# =================================================================
# LOGGING CONFIGURATION - RECOMMENDED
# =================================================================
# Docker log rotation settings
# Maximum size before log rotation (prevents disk space issues)
LOG_MAX_SIZE=10m

# Number of rotated log files to keep
# Balances disk usage with debugging capability
LOG_MAX_FILES=5

# =================================================================
# USAGE INSTRUCTIONS
# =================================================================
# 1. Copy this file: cp .env.example .env
# 2. Edit the .env file with your actual values
# 3. Ensure all REQUIRED variables are set
# 4. Generate strong passwords for all password fields
# 5. Update SITE_NAME to your actual domain
# 6. Configure your DNS to point to your server
# 7. Run: docker compose up -d
# 8. Monitor logs: docker compose logs -f
# 
# Security reminders:
# - Never commit the .env file to version control
# - Use strong, unique passwords for all accounts
# - Regularly update passwords and review access
# - Monitor logs for suspicious activity
# - Keep Docker images updated
# =================================================================